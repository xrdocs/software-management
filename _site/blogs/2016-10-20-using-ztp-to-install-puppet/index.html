

<!doctype html>
<html lang="en" class="no-js">
  <head>
    

<meta charset="utf-8">



<!-- begin SEO -->









<title>            Using ZTP to install Puppet      IOS XR Software Management and ZTP @xrdocs      </title>







<meta property="og:locale" content="en-US">
<meta property="og:site_name" content="IOS XR Software Management and ZTP @xrdocs">
<meta property="og:title" content="Using ZTP to install Puppet">


  <link rel="canonical" href="http://localhost:4000/blogs/2016-10-20-using-ztp-to-install-puppet/">
  <meta property="og:url" content="http://localhost:4000/blogs/2016-10-20-using-ztp-to-install-puppet/">



  <meta property="og:description" content="Installation of the puppet agent using ZTP">



  <meta name="twitter:site" content="@xrdocs">
  <meta name="twitter:title" content="Using ZTP to install Puppet">
  <meta name="twitter:description" content="Installation of the puppet agent using ZTP">
  <meta name="twitter:url" content="http://localhost:4000/blogs/2016-10-20-using-ztp-to-install-puppet/">

  
    <meta name="twitter:card" content="summary">
    
      <meta name="twitter:image" content="http://localhost:4000/images/packaging-xrdocs.jpg">
    
  

  
    <meta name="twitter:creator" content="@pwariche">
  



  

  





  <meta property="og:type" content="article">
  <meta property="article:published_time" content="2016-10-20T21:47:00+00:00">
  
    <link rel="next" href="http://localhost:4000/blogs/2016-10-24-using-ztp-to-install-chef/" title="Using ZTP to install Chef">
  
  
    <link rel="prev" href="http://localhost:4000/blogs/2016-10-17-ios-xr-users-and-groups-inside-linux/" title="IOS-XR users and groups inside Linux">
  



  <script type="application/ld+json">
    {
      "@context": "http://schema.org",
      "@type": "Organization",
      "url": "http://localhost:4000",
      "logo": "http://localhost:4000/images/packaging-xrdocs.jpg"
    }
  </script>



  <script type="application/ld+json">
    {
      "@context" : "http://schema.org",
      "@type" : "person",
      "name" : "Cisco Systems Inc",
      "url" : "http://localhost:4000",
      "sameAs" : ["https://twitter.com/CiscoDevNet"]
    }
  </script>






<!-- end SEO -->

<link href="http://localhost:4000/feed.xml" type="application/atom+xml" rel="alternate" title="IOS XR Software Management and ZTP @xrdocs Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="google-site-verification" content="jgRKKm6B9FwJJPXxpmc0-EP3D0Mh8JHXaJqoYIGj1ek" />

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<script>
if (!(window.location.host.startsWith("127.0.0.1") || window.location.host.startsWith("localhost")) && (window.location.host.substr(-10) == '.github.io') && (window.location.protocol != "https:"))
    window.location.protocol = "https";
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<meta http-equiv="cleartype" content="on">
<style>
.underline-on-hover:hover {
    text-decoration: underline;
}
.searchForm{
      border-radius:5px;
      -moz-border-radius:5px;
      -webkit-border-radius:5px;
      width: 900px;
   }
#search_results{
      display: table; margin:0 auto;
   }
</style>
</style>

    

<!-- start custom head snippets -->

<link href="http://localhost:4000/assets/css/lity.min.css" rel="stylesheet">
<link href="http://localhost:4000/assets/css/cisco-sans.min.css" rel="stylesheet">
<link href="http://localhost:4000/assets/css/material-scrolltop.css" rel="stylesheet">

<link rel="apple-touch-icon-precomposed" sizes="57x57" href="http://localhost:4000/images/apple-touch-icon-57x57.png" />
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="http://localhost:4000/images/apple-touch-icon-114x114.png" />
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="http://localhost:4000/images/apple-touch-icon-72x72.png" />
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://localhost:4000/images/apple-touch-icon-144x144.png" />
<link rel="apple-touch-icon-precomposed" sizes="60x60" href="http://localhost:4000/images/apple-touch-icon-60x60.png" />
<link rel="apple-touch-icon-precomposed" sizes="120x120" href="http://localhost:4000/images/apple-touch-icon-120x120.png" />
<link rel="apple-touch-icon-precomposed" sizes="76x76" href="http://localhost:4000/images/apple-touch-icon-76x76.png" />
<link rel="apple-touch-icon-precomposed" sizes="152x152" href="http://localhost:4000/images/apple-touch-icon-152x152.png" />
<link rel="icon" type="image/png" href="http://localhost:4000/images/favicon-196x196.png" sizes="196x196" />
<link rel="icon" type="image/png" href="http://localhost:4000/images/favicon-96x96.png" sizes="96x96" />
<link rel="icon" type="image/png" href="http://localhost:4000/images/favicon-32x32.png" sizes="32x32" />
<link rel="icon" type="image/png" href="http://localhost:4000/images/favicon-16x16.png" sizes="16x16" />
<link rel="icon" type="image/png" href="http://localhost:4000/images/favicon-128.png" sizes="128x128" />
<link rel="shortcut icon" href="http://localhost:4000/images/favicon_cisco.ico" />
<meta name="application-name" content="&nbsp;"/>
<meta name="msapplication-TileColor" content="#FFFFFF" />
<meta name="msapplication-TileImage" content="http://localhost:4000/images/mstile-144x144.png" />
<meta name="msapplication-square70x70logo" content="http://localhost:4000/images/mstile-70x70.png" />
<meta name="msapplication-square150x150logo" content="http://localhost:4000/images/mstile-150x150.png" />
<meta name="msapplication-wide310x150logo" content="http://localhost:4000/images/mstile-310x150.png" />
<meta name="msapplication-square310x310logo" content="http://localhost:4000/images/mstile-310x310.png" />


<!-- end custom head snippets -->

  </head>

  <body>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->
    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        <button><div class="navicon"></div></button>
        <ul class="visible-links">
          <li class="masthead__menu-item masthead__menu-item--lg"><a href="http://localhost:4000/">Software-Management</a></li>
          
            
            
                
                    <li class="masthead__menu-item"><a href="https://xrdocs.github.io">@xrdocs</a></li>
                
            


          
            
            
                
                    <li class="masthead__menu-item greedy-nav-active"><a href="http://localhost:4000/blogs/">Blogs</a></li>
                
            


          
            
            
                
                    <li class="masthead__menu-item"><a href="http://localhost:4000/tutorials/">Tutorials</a></li>
                
            


          
            
            
                
                    <li class="masthead__menu-item"><a href="http://localhost:4000/search">Search <i class="fa fa-search" aria-hidden="true"></i></a></li>
                
            


          
            
            
                
                    <li class="masthead__menu-item"><a href="http://localhost:4000/tags/">Tags</a></li>
                
            


          
            
            
                
                    <li class="masthead__menu-item"><a href="http://localhost:4000/collection-archive/">Archive</a></li>
                
            


          
        </ul>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    



<div id="main" role="main">
  


  <div class="sidebar sticky">
  



<div itemscope itemtype="http://schema.org/Person">

  <div class="author__avatar">
    
    	<img src="http://localhost:4000/images/pwariche_bio.jpg" class="author__avatar" alt="Patrick Warichet">
    
  </div>

  <div class="author__content">
    <h3 class="author__name">Patrick Warichet</h3>
    <p class="author__bio">Technical Marketing Engineer, Web Solutions, Cisco.</p>
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
      
      
        <li><a href="mailto:pwariche@cisco.com"><i class="fa fa-fw fa-envelope-square" aria-hidden="true"></i> Email</a></li>
      
      
      
        <li><a href="http://twitter.com/pwariche"><i class="fa fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
    </ul>
  </div>
</div>

  
  </div>


  <article class="page" itemscope itemtype="http://schema.org/CreativeWork">
    <meta itemprop="headline" content="Using ZTP to install Puppet">
    <meta itemprop="description" content="Installation of the puppet agent using ZTP">
    <meta itemprop="datePublished" content="October 20, 2016">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 class="page__title" itemprop="headline">Using ZTP to install Puppet
</h1>
          
            <p class="page__meta"><i class="fa fa-clock-o" aria-hidden="true"></i> 


  2 minutes read
</p>
          
        </header>
      

    

      <section class="page__content" itemprop="text">
        <h2 id="introduction">Introduction</h2>
<p>Puppet is a configuration management tool for information technology (IT) professionals. Puppet can potentically manage any resource defined on a node. Puppet can manage complex and distributed components to ensure service consistency and availability. In short, Puppet uses a configuration policy referred to as a “recipe” to bring systems into compliance.</p>

<p>Puppet enables you to make a lot of changes both quickly and consistently. Unlike scripts, you don’t have to write out every step, you only have to define how it should be. You are not required to write out the process for evaluating and verifying different conditions. Instead, you utilize the Puppet configuration language to declare the final state of the resources. This is why Puppet is often described as a declarative language.</p>

<p>The difference between a declarative language and a procedural language is: You tell Puppet the desired end results, but not the steps to get there.</p>

<p>If you choose to use Puppet as your configuration platform, it is important to have the agent installed on the devices early on in the deployment process, and not use any scripting beyond the installation procedure of the agent.</p>

<h2 id="puppet-in-ios-xr">Puppet in IOS-XR</h2>
<p>Puppetlabs have created a puppet agent for the IOS-XR Yocto based Linux. You can follow their installation instructions here:
<a href="https://docs.puppet.com/pe/latest/install_iosxr.html" title="Installing Cisco IOS-XR agents">Installing Cisco IOS-XR agents</a>. Make sure you download the file which has “cisco-wrlinux-7” in the filename, since this is the version that works in the IOS-XR Yocto Linux environment.</p>

<p>If you are interested in using Puppet in conjunction with YANG data models, take a look at the tutorial on Puppet and ciscoyang <a href="https://xrdocs.github.io/application-hosting/tutorials/2016-08-22-using-puppet-with-iosxr-6-1-1" title="Using Puppet with IOS-XR 6.1.1">Using Puppet with IOS-XR 6.1.1</a>. You will have to modify the example below to include the installation of the GRPC GEM file.</p>

<h2 id="script-example">Script Example</h2>
<p>Here is a small example on how to use ZTP to download and install the Puppet package from a local repository, configure the device hostname and enable DNS resolution. The Puppet agent package is secured with a SHA-1 (GPG) key, and you will need to download it to a secure location or access the key directly from Puppetlabs. In the example below, I simply placed the key in the same directory as the RPM package.
Puppet requires all hostnames to be resolved. The script relies on a DNS server to resolve the hostname and include the modifications to IOS-XR Linux. The script also assumes that communication between the Puppet master and the agent will happen over the management interface.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="c">#!/bin/bash</span>

<span class="nv">YUM_REPO</span><span class="o">=</span><span class="s2">"http://172.30.0.22/packages/puppet"</span>
<span class="nv">YUM_PUPPET</span><span class="o">=</span><span class="s2">"/etc/yum/repos.d/puppet.repo"</span>
<span class="nv">PUPPET_SRV</span><span class="o">=</span><span class="s2">"puppet-master.cisco.local"</span>
<span class="nv">PUPPET_CONF</span><span class="o">=</span><span class="s2">"/etc/puppetlabs/puppet/puppet.conf"</span>
<span class="nv">DOMAIN</span><span class="o">=</span><span class="s2">"cisco.local"</span>
<span class="nv">DOMAIN_SRV</span><span class="o">=</span>172.30.0.25
<span class="nv">HOSTNAME</span><span class="o">=</span><span class="s2">"ncs-5001-c"</span>
<span class="nv">MGMT_IP</span><span class="o">=</span><span class="s2">"172.30.12.54 255.255.255.0"</span>

<span class="nb">source </span>ztp_helper.sh

<span class="k">function </span>create_repo<span class="o">(){</span>
   <span class="c"># Create local repository file for puppet</span>
   <span class="nb">echo</span> <span class="s2">"### created by ztp </span><span class="k">$(</span>date +<span class="s2">"%b %d %H:%M:%S"</span><span class="k">)</span><span class="s2"> ###"</span> &gt; <span class="nv">$YUM_PUPPET</span>
   <span class="nb">echo</span> -ne <span class="s2">"[puppetlabs]</span><span class="se">\n</span><span class="s2">name=puppetlabs</span><span class="se">\n</span><span class="s2">enabled=1</span><span class="se">\n</span><span class="s2">gpgcheck=1</span><span class="se">\n</span><span class="s2">"</span> &gt;&gt; <span class="nv">$YUM_PUPPET</span>
   <span class="nb">echo</span> <span class="s2">"baseurl=</span><span class="nv">$YUM_REPO</span><span class="s2">"</span> &gt;&gt; <span class="nv">$YUM_PUPPET</span>
   <span class="nb">echo</span> <span class="s2">"gpgkey=</span><span class="nv">$YUM_REPO</span><span class="s2">/RPM-GPG-KEY-puppetlabs"</span> &gt;&gt; <span class="nv">$YUM_PUPPET</span> 
<span class="o">}</span>
<span class="k">function </span>install_puppet<span class="o">(){</span>
   <span class="c"># Install puppet </span>
   /usr/bin/yum clean all &gt; /dev/null
   /usr/bin/yum update &gt; /dev/null
   /usr/bin/yum install -y puppet &gt; /dev/null
<span class="o">}</span>
<span class="k">function </span>config_puppet<span class="o">(){</span>
  <span class="nb">echo</span> <span class="s2">"### created by ztp </span><span class="k">$(</span>date +<span class="s2">"%b %d %H:%M:%S"</span><span class="k">)</span><span class="s2"> ###"</span> &gt; <span class="nv">$PUPPET_CONF</span>
  <span class="nb">echo</span> -ne <span class="s2">"[main]</span><span class="se">\n</span><span class="s2">server = </span><span class="nv">$PUPPET_SRV</span><span class="se">\n</span><span class="s2">"</span> &gt;&gt; <span class="nv">$PUPPET_CONF</span>
<span class="o">}</span>
<span class="k">function </span>setup_resolver<span class="o">(){</span>
  <span class="nb">local </span><span class="nv">resolver</span><span class="o">=</span>/etc/resolv.conf
  <span class="nb">echo</span> <span class="s2">"### created by ztp </span><span class="k">$(</span>date +<span class="s2">"%b %d %H:%M:%S"</span><span class="k">)</span><span class="s2"> ###"</span> &gt; <span class="nv">$resolver</span>
  <span class="nb">echo</span> <span class="s2">"domain </span><span class="nv">$DOMAIN</span><span class="s2">"</span> &gt;&gt; <span class="nv">$resolver</span>
  <span class="nb">echo</span> <span class="s2">"search </span><span class="nv">$DOMAIN</span><span class="s2">"</span> &gt;&gt; <span class="nv">$resolver</span>
  <span class="nb">echo</span> <span class="s2">"nameserver </span><span class="nv">$DOMAIN_SRV</span><span class="s2">"</span> &gt;&gt; <span class="nv">$resolver</span>  
<span class="o">}</span>
<span class="k">function </span>set_hostname<span class="o">(){</span>
  xrapply_string_with_reason <span class="s2">"ztp puppet install"</span> <span class="s2">"hostname </span><span class="nv">$HOSTNAME</span><span class="se">\n</span><span class="s2"> interface mgmtEth 0/RP0/CPU0/0</span><span class="se">\n</span><span class="s2"> ipv4 address </span><span class="nv">$MGMT_IP</span><span class="s2"> </span><span class="se">\n</span><span class="s2">"</span>
  /bin/hostname -f <span class="nv">$HOSTNAME</span>.<span class="nv">$DOMAIN</span>
  <span class="nb">echo</span> <span class="nv">$HOSTNAME</span> &gt; /etc/hostname  
<span class="o">}</span>
<span class="k">function </span>start_services<span class="o">(){</span>
  /etc/init.d/sshd_operns start
  /etc/init.d/puppet start
<span class="o">}</span>

<span class="c">### script start</span>
set_hostname;
setup_resolver;
create_repo;
install_puppet;
config_puppet;
start_services;
<span class="nb">exit </span>0

</code></pre>
</div>

        
      </section>

      <footer class="page__meta">
        
        




  
  
  

  <p class="page__taxonomy">
    <strong><i class="fa fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="http://localhost:4000/tags/#iosxr" class="page__taxonomy-item" rel="tag">iosxr</a><span class="sep">, </span>
    
      
      
      <a href="http://localhost:4000/tags/#linux" class="page__taxonomy-item" rel="tag">linux</a><span class="sep">, </span>
    
      
      
      <a href="http://localhost:4000/tags/#puppet" class="page__taxonomy-item" rel="tag">puppet</a><span class="sep">, </span>
    
      
      
      <a href="http://localhost:4000/tags/#ztp" class="page__taxonomy-item" rel="tag">ZTP</a>
    
    </span>
  </p>


        
          <p class="page__date"><strong><i class="fa fa-fw fa-calendar" aria-hidden="true"></i> Updated:</strong> <time datetime="2016-10-20T21:47:00+00:00">October 20, 2016</time></p>
        
      </footer>

      

<section class="page__share">
  
    <h4 class="page__share-title">Share on</h4>
  

  <a href="https://twitter.com/intent/tweet?text=http://localhost:4000/blogs/2016-10-20-using-ztp-to-install-puppet/" class="btn btn--twitter" title="Share on Twitter"><i class="fa fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:4000/blogs/2016-10-20-using-ztp-to-install-puppet/" class="btn btn--facebook" title="Share on Facebook"><i class="fa fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://plus.google.com/share?url=http://localhost:4000/blogs/2016-10-20-using-ztp-to-install-puppet/" class="btn btn--google-plus" title="Share on Google Plus"><i class="fa fa-fw fa-google-plus" aria-hidden="true"></i><span> Google+</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=http://localhost:4000/blogs/2016-10-20-using-ztp-to-install-puppet/" class="btn btn--linkedin" title="Share on LinkedIn"><i class="fa fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>

    <br>
    <br>
    <br>
</section>


    </div>

    
      

<div class="page__comments">
  <h4 class="page__comments-title">Leave a Comment</h4>
  
    <section id="disqus_thread"></section>
  
</div>
    
  </article>

  
  
</div>


    <div class="page__footer">
      <footer>
        

<div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    
    
      <li><a href="https://twitter.com/xrdocs"><i class="fa fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
    
    
    
      <li><a href="http://github.com/xrdocs"><i class="fa fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
    
    
    <li><a href="http://localhost:4000/feed.xml"><i class="fa fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2017 Cisco Systems Inc. Powered by <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>
      </footer>
    </div>

    <script src="http://localhost:4000/assets/js/main.min.js"></script>
<script src="http://localhost:4000/assets/js/scrollmenu.js"></script>




  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-78256516-1', 'auto');
  ga('send', 'pageview');
</script>






  
  <script type="text/javascript">
  	/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
  	var disqus_shortname = 'xrdocs';

  	/* * * DON'T EDIT BELOW THIS LINE * * */
  	(function() {
  		var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  		dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  		(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  	})();

  	/* * * DON'T EDIT BELOW THIS LINE * * */
  	(function () {
  		var s = document.createElement('script'); s.async = true;
  		s.type = 'text/javascript';
  		s.src = '//' + disqus_shortname + '.disqus.com/count.js';
  		(document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
  	}());
  </script>
  <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>






<!-- material-scrolltop button -->
<button class="material-scrolltop" type="button"></button>

<!-- material-scrolltop plugin -->
<script src="http://localhost:4000/assets/js/material-scrolltop.js"></script>

<!-- Initialize material-scrolltop with (minimal) -->
<script>
    $('body').materialScrollTop();
</script>


  </body>
</html>

