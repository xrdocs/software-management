---
published: false
date: '2017-12-06 16:12 -0800'
title: IOS-XR NSO Integration Part 1 (Using PnP)
---
# Introduction
Network Services Orchestrator provides end-to-end orchestration that 
spans multiple domains in your network.

Using strict, standardized YANG models for both services and devices and a highly efficient abstraction layer between your network services and the underlying infrastructure, the orchestrator lets you automate all the multivendor devices.

## PnP

The NSO PnP Server is a NSO Component which enables management of Cisco PnP clients. The NSO PnP Server provides the Cisco PnP clients with configuration, typically configuration needed at the first boot of the client (Day-0 configuration).

## ZTP
ZTP does not currently include PnP capabilities, in this article we describes a method to use the ZTP feature of IOS XR and Cisco PnP to automatically deploy a Day-0 configuration and register a device to NSO during its initial boot. NSO will then be able to initiate a connection to the device (through a Netconf NED or a CLI NED), execute a sync-from command and deploy a service thanks to reactive FASTMAP feature.

ZTP allows you download and execute a shell script at first boot. This script (pre-agg.sh in our example) will do the following tasks:

* Downloads on the device a Docker container embedding the PnP agent

* Downloads and applies a basic configuration enabling netconf on the device

* Download and applies a configuration for the PnP agent.

* Launch the container

The PnP Agent will be in charge of notifying the NSO server that the device has completed its booting sequence and performs a 4-way handshake with the NSO server. The PnP Server will first send a Day-0 configuration, the agent will apply it and the server will register the device into the NSO CDB. After the third PnP Work Request, the PnP Server package triggers a sync-from and the reactive FASTMAP mechanism to deploy services.

## The PnP Agent

PnP is a protocol that allows a day-0 configuration of a device thanks to a server that has a back-end configuration. The server identifies the device (or agent) with its serial number. This rxample does not use PnP credentials and has not been tested using HTTPS.

The PnP Agent will look for a configuration file in /root/config/cisco-pnp-agent.conf that has been made available inside the container.

PnP workflow that has been tested:

* PnP Hello 4-way handshake between server and agent.

* Agent sends PnP Work Request

* Server sends the block of configuration lines.

* Agent apply each line one by one and check for syntax error, incomplete command or commit error and sends a response to the server.

Since the agent resides inside a container, it must communicate with the XR control plane through the network. The container uses the fwd_ew interface and the Loopback1 IP address.

The agent uses SSH to access XR console. For all these reasons, the PnP Agent configuration file must include the Loopback1 IP address and valid credentials for SSH. The file cisco-pnp-agent.conf is an example of configuration, this file is automatically generated by the bash script during the ZTP process in our example (see pre-agg.sh).
